{{ define "main" }}
<!-- Page Header -->
<section class="list-header">
    <div class="list-header-content">
        {{ if eq .Type "posts" }}
            <div class="list-icon">üìö</div>
            <h1 class="list-title">Tous les articles</h1>
            <p class="list-description">
                D√©couvrez tous les articles du blog, class√©s par date de publication. 
                {{ len .Pages }} articles disponibles.
            </p>
        {{ else if .IsHome }}
            <div class="list-icon">üè†</div>
            <h1 class="list-title">{{ .Site.Title }}</h1>
            <p class="list-description">{{ .Site.Params.description }}</p>
        {{ else if eq .Kind "taxonomy" }}
            {{ if eq .Type "categories" }}
                <div class="list-icon">üè∑Ô∏è</div>
                <h1 class="list-title">Cat√©gorie : {{ .Title }}</h1>
                <p class="list-description">
                    Articles de la cat√©gorie "{{ .Title }}". 
                    {{ len .Pages }} articles trouv√©s.
                </p>
            {{ else if eq .Type "tags" }}
                <div class="list-icon">üîñ</div>
                <h1 class="list-title">Tag : {{ .Title }}</h1>
                <p class="list-description">
                    Articles avec le tag "{{ .Title }}". 
                    {{ len .Pages }} articles trouv√©s.
                </p>
            {{ end }}
        {{ else if eq .Kind "section" }}
            <div class="list-icon">üìÇ</div>
            <h1 class="list-title">{{ .Title }}</h1>
            {{ if .Content }}
                <div class="list-description">{{ .Content }}</div>
            {{ else }}
                <p class="list-description">{{ len .Pages }} articles dans cette section.</p>
            {{ end }}
        {{ else }}
            <div class="list-icon">üìñ</div>
            <h1 class="list-title">{{ .Title }}</h1>
            {{ if .Content }}
                <div class="list-description">{{ .Content }}</div>
            {{ end }}
        {{ end }}
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="/">Accueil</a>
            {{ if ne .Type "posts" }}
                {{ if eq .Kind "taxonomy" }}
                    <span class="breadcrumb-separator">‚Üí</span>
                    <a href="/{{ .Type }}/">{{ if eq .Type "categories" }}Cat√©gories{{ else }}Tags{{ end }}</a>
                {{ else if eq .Kind "section" }}
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">{{ .Title }}</span>
                {{ end }}
            {{ end }}
            {{ if eq .Kind "taxonomy" }}
                <span class="breadcrumb-separator">‚Üí</span>
                <span class="breadcrumb-current">{{ .Title }}</span>
            {{ end }}
        </nav>
    </div>
</section>

<!-- Filters and Search -->
<section class="list-filters">
    <div class="filters-container">
        <!-- Search Box -->
        <div class="search-box">
            <input type="text" id="search-input" placeholder="üîç Rechercher dans les articles..." class="search-input">
        </div>
        
        <!-- Category Filter (if not already in category page) -->
        {{ if ne .Kind "taxonomy" }}
        <div class="filter-dropdown">
            <select id="category-filter" class="filter-select">
                <option value="">Toutes les cat√©gories</option>
                {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
                <option value="{{ $name }}">{{ title $name }} ({{ len $taxonomy }})</option>
                {{ end }}
            </select>
        </div>
        {{ end }}
        
        <!-- Sort Options -->
        <div class="filter-dropdown">
            <select id="sort-filter" class="filter-select">
                <option value="date-desc">Plus r√©cent d'abord</option>
                <option value="date-asc">Plus ancien d'abord</option>
                <option value="title-asc">Titre A-Z</option>
                <option value="title-desc">Titre Z-A</option>
            </select>
        </div>
        
        <!-- Results Count -->
        <div class="results-count">
            <span id="results-count">{{ len .Pages }}</span> article{{ if ne (len .Pages) 1 }}s{{ end }}
        </div>
    </div>
</section>

<!-- Articles Grid -->
<section class="articles-list">
    {{ if .Pages }}
        <div class="articles-grid" id="articles-grid">
            {{ range .Paginator.Pages }}
            <article class="article-card" data-title="{{ .Title | lower }}" data-category="{{ delimit .Params.categories " " | lower }}" data-date="{{ .Date.Format "2006-01-02" }}">
                {{ if .Params.image }}
                <div class="article-image">
                    <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
                    <div class="article-overlay"></div>
                </div>
                {{ else }}
                <div class="article-image placeholder-image">
                    <div class="placeholder-icon">
                        {{ if in .Params.categories "ia" }}ü§ñ
                        {{ else if in .Params.categories "tech" }}üíª
                        {{ else if in .Params.categories "systemes" }}üõ†Ô∏è
                        {{ else if in .Params.categories "dev" }}‚ö°
                        {{ else }}üìÑ{{ end }}
                    </div>
                </div>
                {{ end }}
                
                <div class="article-content">
                    <div class="article-meta">
                        {{ range .Params.categories }}
                        <span class="category-tag">{{ . }}</span>
                        {{ end }}
                        <time class="article-date" datetime="{{ .Date.Format "2006-01-02" }}">
                            {{ .Date.Format "2 Jan 2006" }}
                        </time>
                    </div>
                    
                    <h3 class="article-title">
                        <a href="{{ .Permalink }}">{{ .Title }}</a>
                    </h3>
                    
                    <p class="article-excerpt">
                        {{ if .Params.description }}
                            {{ .Params.description | truncate 120 }}
                        {{ else }}
                            {{ .Summary | truncate 120 }}
                        {{ end }}
                    </p>
                    
                    <div class="article-footer">
                        <div class="article-stats">
                            <span class="reading-time">‚è±Ô∏è {{ .ReadingTime }} min</span>
                            {{ if .Params.tags }}
                            <span class="tags-count">üè∑Ô∏è {{ len .Params.tags }} tags</span>
                            {{ end }}
                        </div>
                        <a href="{{ .Permalink }}" class="read-more">Lire ‚Üí</a>
                    </div>
                </div>
            </article>
            {{ end }}
        </div>
        
        <!-- No Results Message (hidden by default) -->
        <div class="no-results" id="no-results" style="display: none;">
            <div class="no-results-content">
                <div class="no-results-icon">üîç</div>
                <h3>Aucun article trouv√©</h3>
                <p>Essayez de modifier vos crit√®res de recherche ou de navigation.</p>
                <a href="/posts/" class="btn btn-primary">Voir tous les articles</a>
            </div>
        </div>
        
        <!-- Pagination -->
        {{ if gt .Paginator.TotalPages 1 }}
        <nav class="pagination">
            {{ if .Paginator.HasPrev }}
            <a href="{{ .Paginator.Prev.URL }}" class="pagination-btn prev">
                ‚Üê Pr√©c√©dent
            </a>
            {{ end }}
            
            <div class="pagination-numbers">
                {{ range .Paginator.Pagers }}
                {{ if eq . $.Paginator }}
                <span class="pagination-current">{{ .PageNumber }}</span>
                {{ else }}
                <a href="{{ .URL }}" class="pagination-number">{{ .PageNumber }}</a>
                {{ end }}
                {{ end }}
            </div>
            
            {{ if .Paginator.HasNext }}
            <a href="{{ .Paginator.Next.URL }}" class="pagination-btn next">
                Suivant ‚Üí
            </a>
            {{ end }}
        </nav>
        {{ end }}
    {{ else }}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-content">
                <div class="empty-state-icon">üìù</div>
                <h3>Aucun article disponible</h3>
                <p>Il n'y a pas encore d'articles dans cette section.</p>
                <a href="/" class="btn btn-primary">Retour √† l'accueil</a>
            </div>
        </div>
    {{ end }}
</section>

<!-- Newsletter Section -->
{{ if and .Site.Params.newsletter.enabled (ne .Kind "taxonomy") }}
<section class="list-newsletter">
    <div class="newsletter-card">
        <div class="newsletter-content">
            <h3>üìß Restez inform√©</h3>
            <p>Recevez les nouveaux articles directement dans votre bo√Æte mail</p>
        </div>
        <form class="newsletter-form" action="{{ .Site.Params.newsletter.action }}" method="post">
            <input type="email" placeholder="votre@email.com" required class="newsletter-input">
            <button type="submit" class="btn btn-primary">S'abonner</button>
        </form>
    </div>
</section>
{{ end }}

<!-- JavaScript for filtering and search -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const sortFilter = document.getElementById('sort-filter');
    const articlesGrid = document.getElementById('articles-grid');
    const resultsCount = document.getElementById('results-count');
    const noResults = document.getElementById('no-results');
    
    let allArticles = Array.from(document.querySelectorAll('.article-card'));
    
    function filterAndSort() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategory = categoryFilter ? categoryFilter.value : '';
        const sortBy = sortFilter.value;
        
        // Filter articles
        let filteredArticles = allArticles.filter(article => {
            const titleMatch = article.dataset.title.includes(searchTerm);
            const categoryMatch = !selectedCategory || article.dataset.category.includes(selectedCategory);
            
            return titleMatch && categoryMatch;
        });
        
        // Sort articles
        filteredArticles.sort((a, b) => {
            switch(sortBy) {
                case 'date-desc':
                    return new Date(b.dataset.date) - new Date(a.dataset.date);
                case 'date-asc':
                    return new Date(a.dataset.date) - new Date(b.dataset.date);
                case 'title-asc':
                    return a.dataset.title.localeCompare(b.dataset.title);
                case 'title-desc':
                    return b.dataset.title.localeCompare(a.dataset.title);
                default:
                    return 0;
            }
        });
        
        // Update display
        allArticles.forEach(article => {
            article.style.display = 'none';
        });
        
        if (filteredArticles.length > 0) {
            filteredArticles.forEach(article => {
                article.style.display = 'block';
            });
            noResults.style.display = 'none';
            articlesGrid.style.display = 'grid';
        } else {
            noResults.style.display = 'block';
            articlesGrid.style.display = 'none';
        }
        
        // Update results count
        resultsCount.textContent = filteredArticles.length;
    }
    
    // Event listeners
    searchInput.addEventListener('input', filterAndSort);
    if (categoryFilter) categoryFilter.addEventListener('change', filterAndSort);
    sortFilter.addEventListener('change', filterAndSort);
});
</script>

<style>
/* List Page Styles */
.list-header {
    text-align: center;
    padding: 4rem 2rem 2rem;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
}

.list-header-content {
    max-width: 800px;
    margin: 0 auto;
}

.list-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.list-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    background: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.list-description {
    font-size: 1.25rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 2rem;
}

.breadcrumb {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.breadcrumb a {
    color: var(--accent-primary);
    text-decoration: none;
}

.breadcrumb a:hover {
    text-decoration: underline;
}

.breadcrumb-separator {
    color: var(--text-tertiary);
}

.breadcrumb-current {
    color: var(--text-primary);
    font-weight: 500;
}

/* Filters */
.list-filters {
    padding: 2rem;
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
}

.filters-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr auto auto auto;
    gap: 1rem;
    align-items: center;
}

.search-box {
    position: relative;
}

.search-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 1rem;
}

.search-input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(var(--accent-primary-rgb), 0.1);
}

.filter-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 0.875rem;
    min-width: 180px;
}

.filter-select:focus {
    outline: none;
    border-color: var(--accent-primary);
}

.results-count {
    font-size: 0.875rem;
    color: var(--text-secondary);
    white-space: nowrap;
}

/* Articles Grid */
.articles-list {
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

/* Empty State */
.empty-state,
.no-results {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state-content,
.no-results-content {
    max-width: 400px;
    margin: 0 auto;
}

.empty-state-icon,
.no-results-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.empty-state h3,
.no-results h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--text-primary);
}

.empty-state p,
.no-results p {
    color: var(--text-secondary);
    margin-bottom: 2rem;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 3rem;
    padding: 2rem 0;
}

.pagination-btn {
    padding: 0.75rem 1.5rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    text-decoration: none;
    transition: var(--transition);
}

.pagination-btn:hover {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
}

.pagination-numbers {
    display: flex;
    gap: 0.5rem;
}

.pagination-number {
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    text-decoration: none;
    transition: var(--transition);
}

.pagination-number:hover {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
}

.pagination-current {
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-primary);
    color: white;
    border-radius: var(--border-radius);
    font-weight: 600;
}

/* Newsletter in list */
.list-newsletter {
    margin-top: 4rem;
    padding: 2rem;
    background: var(--bg-secondary);
    border-radius: var(--border-radius-lg);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .filters-container {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .filter-select {
        min-width: auto;
        width: 100%;
    }
    
    .articles-grid {
        grid-template-columns: 1fr;
    }
    
    .list-title {
        font-size: 2rem;
    }
    
    .pagination {
        flex-direction: column;
        gap: 1rem;
    }
    
    .pagination-numbers {
        order: -1;
    }
}
</style>
{{ end }}